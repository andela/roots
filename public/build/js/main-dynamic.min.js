"use strict";angular.module("eventApp",["ui.router","ngMaterial","ngMessages","ngResource","ngAnimate","ngAria","summernote","ngFileUpload","ngAutocomplete","color.picker","ui.bootstrap","ui.bootstrap.datetimepicker","ngMap"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("landing.home",{url:"/home",templateUrl:"../app/views/home.view.html",controller:"homeCtrl"}).state("landing",{url:"/landing",templateUrl:"../app/views/navbar.view.html",controller:"homeCtrl"}).state("user.passwordreset",{url:"/passwordreset/:token",templateUrl:"../app/views/password.reset.html",controller:"resetPasswordCtrl"}).state("user.registration",{url:"/registration",templateUrl:"../app/views/twitter.user.html",controller:"twitterCtrl"}).state("user.cevent",{url:"/cevent",templateUrl:"../app/views/event.view.html",controller:"eventCtrl"}).state("user",{url:"/user",templateUrl:"../app/views/user.view.html",controller:"homeCtrl"}).state("user.editEvent",{url:"/event/:event_id",templateUrl:"../app/views/editEvent.view.html",controller:"editeventCtrl"}).state("user.profile",{url:"/profile",templateUrl:"../app/views/user.profile.html",controller:"profileCtrl"}).state("user.eventDetails",{url:"/eventdetails/:event_id",templateUrl:"../app/views/eventDetails.view.html",controller:"eventViewCtrl"}).state("user.moreEvents",{url:"/more-events",templateUrl:"../app/views/more.events.view.html",controller:"moreEventsCtrl"}).state("user.eventTasks",{url:"/eventtasks/:event_id",templateUrl:"../app/views/event.task.html",controller:"eventTaskCtrl"}),t.otherwise("/landing/home")}]),angular.module("eventApp").config(["$mdThemingProvider",function(e){var t=e.extendPalette("red",{500:"2f4f4f"});e.definePalette("neonRed",t),e.theme("default").primaryPalette("neonRed").accentPalette("light-blue",{"default":"50"}).warnPalette("red")}]),angular.module("eventApp").directive("countryList",function(){return{restrict:"E",scope:{countryCode:"="},templateUrl:"../app/views/country.list.html"}}),angular.module("eventApp").directive("addressBasedGoogleMap",function(){return{restrict:"A",template:"<div id='addressMap'></div>",scope:{address:"=",zoom:"="},controller:["$scope",function(e){var t,n,r,o,a=function(){t=new google.maps.Geocoder;var o={zoom:e.zoom,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP};r=new google.maps.Map(document.getElementById("addressMap"),o)},s=function(){t.geocode({address:e.address},function(e,t){t===google.maps.GeocoderStatus.OK&&(r.setCenter(e[0].geometry.location),o=new google.maps.Marker({map:r,position:e[0].geometry.location}))})};e.$watch("address",function(){void 0!==e.address&&s()}),a()}]}}),angular.module("eventApp").directive("jqdatepicker",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){$(element).datepicker({dateFormat:"mm-dd-yy",minDate:0,onSelect:function(date){var ngModelName=this.attributes["ng-model"].value;if(-1!==ngModelName.indexOf(".")){var objAttributes=ngModelName.split("."),lastAttribute=objAttributes.pop(),partialObjString=objAttributes.join("."),partialObj=eval("scope."+partialObjString);partialObj[lastAttribute]=date}else scope[ngModelName]=date;scope.$apply()}})}}}),angular.module("eventApp").controller("editeventCtrl",["$scope","$stateParams","$location","EventService","OrganizerService","Upload","$rootScope","$state","$sce",function(e,t,n,r,o,a,s,i,l){function u(e){return new Date(Date.parse(e))}localStorage.getItem("userToken")||n.url("/user/home"),s.hideBtn=!0,r.getEvent(t.event_id).success(function(t){t.details.startDate=u(t.details.startDate),t.details.endDate=u(t.details.endDate),e.event=t.details,$(".md-warn").css("border-color",e.event.eventTheme.borderColor),$(".md-warn").css("background-color",e.event.eventTheme.headerColor),$(".md-warn").css("color",e.event.eventTheme.fontColor),$(".values").css("border-color",e.event.eventTheme.borderColor),$(".values").css("background-color",e.event.eventTheme.contentColor),$(".values").css("color",e.event.eventTheme.fontColor),e.event.user_ref.organizer_ref&&o.getOrganizer(e.event.user_ref.organizer_ref).success(function(t){e.organizer=t,e.organizer.phoneNumber1=e.event.user_ref.phoneNumber1})}),e.categories="Technology,Sport,Health & Fitness,Music,Food & Drink,Arts,Parties,Business".split(",").map(function(e){return{name:e}}),e.previewImg=function(e,t,n){$(e).on("change",function(){var r=document.querySelector(t),o=document.querySelector(e).files[0],a=document.querySelector(n),s=new FileReader;s.onloadend=function(){r.src=s.result,a&&(a.src=s.result)},o?s.readAsDataURL(o):(r.src="",a.src="")})},e.submitEventDetails=function(n){return n.startDate&&n.endDate?n.startDate>n.endDate?void $window.alert("invalid date range"):(n.venue.country=e.getCountryCode().text,void r.editEventDetails(n,t.event_id).success(function(e){i.go("user.eventDetails",{event_id:t.event_id}),document.body.scrollTop=document.documentElement.scrollTop=0})):void $window.alert("Select event start and end dates")},e.getCountryCode=function(){var e=document.getElementById("ddlViewBy"),t=e.options[e.selectedIndex].value,n=e.options[e.selectedIndex].text;return{code:t,text:n}},e.getCountry=function(){e.result="",e.options1={country:e.getCountryCode().code},e.details=""},e.cancelEdit=function(){i.go("user.eventDetails",{event_id:t.event_id}),document.body.scrollTop=document.documentElement.scrollTop=0},e.switchView=function(){e.prev=!e.prev,document.body.scrollTop=document.documentElement.scrollTop=0},e.$watch("event.description",function(t,n){t!==n&&(e.eventInfo=l.trustAsHtml(e.event.description))}),e.prev=!1}]),angular.module("eventApp").controller("eventCtrl",["$scope","$stateParams","UserService","$location","EventService","Upload","$rootScope","$state","$window","$sce",function(e,t,n,r,o,a,s,i,l,u){localStorage.getItem("userToken")?(s.hideBtn=!0,n.getCurrentUser().success(function(t){t.organizer_ref&&(e.organizer=t.organizer_ref,e.organizer.phoneNumber1=t.phoneNumber1,e.organizer.phoneNumber2=t.phoneNumber2)}).error(function(e){})):r.url("/home"),s.hideBtn=!0,e.submitEventDetails=function(t,n){return t.startDate&&t.endDate?t.startDate>t.endDate?void l.alert("invalid date range"):(t.venue.country=e.getCountryCode().text,e.isLoading=!0,o.createEvent(t).success(function(e){i.go("user.eventDetails",{event_id:e._id}),document.body.scrollTop=document.documentElement.scrollTop=0}),void 0):void l.alert("Select event start and end dates")},e.view="create",e.currDisplay=function(t){e.view=t},e.switchView=function(){e.prev=!e.prev,document.body.scrollTop=document.documentElement.scrollTop=0},e.categories="Technology,Sport,Health,Music,Art,Science,Spirituality,Media,Family,Education,Party".split(",").map(function(e){return{name:e}}),e.getCountryCode=function(){var e=document.getElementById("ddlViewBy"),t=e.options[e.selectedIndex].value,n=e.options[e.selectedIndex].text;return{code:t,text:n}},e.getCountry=function(){e.venue||(e.venue={}),e.venue.address="",e.options1={country:e.getCountryCode().code},e.details=""},e.publishEvent=function(t){e.event.online=t},e.previewImg=function(e,t,n){$(e).on("change",function(){var r=document.querySelector(t),o=document.querySelector(e).files[0],a=document.querySelector(n),s=new FileReader;s.onloadend=function(){r.src=s.result,a&&(a.src=s.result)},o&&a||o?s.readAsDataURL(o):(r.src="",a.src="")})},e.changeColor=function(e){$("md-toolbar.md-warn").css("background-color",e)},e.$watch("event.description",function(t,n){t!==n&&(e.eventInfo=u.trustAsHtml(e.event.description))}),e.event={eventTheme:{headerColor:"rgb(30, 25, 84)",borderColor:"",fontColor:"rgb(155, 86, 86)",contentColor:""},venue:{}},e.fetchEvents=function(){o.getAllEvents().then(function(t){e.eventList=t.data})},e.prev=!1,e.organizer={about:"",phoneNumber1:""}}]),angular.module("eventApp").controller("eventTaskCtrl",["$scope","$stateParams","$location","EventService","OrganizerService","TaskService","$rootScope","$state","$window",function(e,t,n,r,o,a,s,i,l){function u(e,t){422===Number(t)||401===Number(t)||403===Number(t)?l.alert(e.message):l.alert("An error just occured, please try again!")}function c(e){return new Date(Date.parse(e))}e.staff=[],e.searchText="",e.newTask={},e.services=function(){localStorage.getItem("userToken")?r.getEvent(t.event_id).success(function(n){e.event=n.details,e.role=n.role,e.isEventOwner()?(a.getAllTasks(t.event_id).success(function(t){var n;e.tasks=t.map(function(e){return n=angular.extend({},e.manager_ref),e.manager_ref=n._id,e.firstname=n.firstname,e.lastname=n.lastname,e.email=n.email,e.startDate=c(e.startDate),e.endDate=c(e.endDate),e})}),o.getMyProfile().success(function(t){var n;e.staff=t.staff.map(function(e){return n={},n.memberId=e._id,n.manager_ref=e.manager_ref._id,n.firstname=angular.lowercase(e.manager_ref.firstname),n.lastname=angular.lowercase(e.manager_ref.lastname),n.email=angular.lowercase(e.manager_ref.email),n.profilePic=e.manager_ref.profilePic,n.description=e.role,n}),e.searchLabel=e.staff.length?"Search team member and assign task...":"Add team members to organizer profile"})):e.isTaskManager()?(e.volunteers=[],e.tasks=[],e.schedule={},e.volunteer={},e.pendingVolunteers=[],a.getAllUserEventTasks(t.event_id).success(function(n){e.tasks=n;for(var r=0;r<n.length;r++)for(var o=0;o<n.volunteers.length;o++){var s={};s=angular.copy(n[r].volunteers[o].volunteer_ref),s.task=angular.lowercase(n[r].description),s.taskId=n[r]._id,s.user_ref.firstname=angular.lowercase(s.user_ref.firstname),s.user_ref.lastname=angular.lowercase(s.user_ref.lastname),e.volunteers.push(s)}a.getEventPendingVolunteers(t.event_id).success(function(t){e.pendingVolunteers=t})})):e.isVolunteer()&&(e.volunteers=[],a.getAllMyEventVolunteers(t.event_id).success(function(t){e.volunteers=t}))}):n.url("/home")},s.hideBtn=!1,e.addTask=function(){return e.newTask.startDate>e.newTask.endDate?void l.alert("invalid date range"):void a.createTask(t.event_id,{newTask:e.newTask}).success(function(t){var n=angular.copy(e.newTask);n._id=t._id,e.tasks.push(n),e.newTask={},l.alert("Task added!")}).error(function(e,t){u(e,t)})},e.deleteTask=function(n){a.deleteTask(t.event_id,n).success(function(t){for(var r=-1,o=0;o<e.tasks.length;o++)if(e.tasks[o]._id.toString()===n.toString()){r=o;break}-1!==r&&e.tasks.splice(r,1),l.alert("Task deleted!")}).error(function(e,t){u(e,t)})},e.editTask=function(e){return e.startDate>e.endDate?void l.alert("invalid date range"):void a.editTask(t.event_id,e._id,{newTask:e}).success(function(e){l.alert("Task modified!")}).error(function(e,t){u(e,t)})},e.viewEvent=function(){i.go("user.eventDetails",{event_id:t.event_id}),document.body.scrollTop=document.documentElement.scrollTop=0},e.addVolunteerToTask=function(t){a.addVolunteerToTask(t.task_ref._id,t._id).success(function(n){t.added=!0,t.task_ref=t.task_ref._id;for(var r=0;r<e.tasks.length;r++)if(e.tasks[r]._id===t.task_ref){e.tasks[r].push({volunteer_ref:t});var o=angular.copy(t);o.task=angular.lowercase(e.tasks[r].description),o.taskId=e.tasks[r]._id,o.user_ref.firstname=angular.lowercase(o.user_ref.firstname),o.user_ref.lastname=angular.lowercase(o.user_ref.lastname),e.volunteers.push(o);for(var a=-1,s=0;s<e.pendingVolunteers.length;s++)if(e.pendingVolunteers[s]._id===t._id){a=s;break}a>-1&&e.pendingVolunteers.splice(a,1);break}l.alert("Volunteer added.")}).error(function(e,t){u(e,t)})},e.removeVolunteerFromTask=function(t,n,r){a.removeVolunteerFromTask(t,n).success(function(o){if(r){for(var a=-1,s=0;s<e.tasks.length;s++)if(e.tasks[s]._id===t){for(var i=0;i<e.tasks[s].volunteers.length;i++)if(e.tasks[s].volunteers[i].volunteer_ref._id===n){a=i;break}a>-1&&e.tasks[s].volunteers.splice(a,1);break}a=-1;for(var s=0;s<e.volunteers.length;s++)if(e.volunteers[s]._id===n){a=s;break}a>-1&&e.volunteers.splice(a,1)}else{for(var a=-1,s=0;s<e.pendingVolunteers.length;s++)if(e.pendingVolunteers[s]._id===n){a=s;break}a>-1&&e.pendingVolunteers.splice(a,1)}l.alert("Volunteer removed!")}).error(function(e,t){u(e,t)})},e.addTaskSchedule=function(){a.addTaskSchedule(e.volunteer.taskId,e.volunteer._id,e.schedule).success(function(t){for(var n=0;n<e.tasks.length;n++){if(e.tasks[n]._id===e.volunteer.taskId)for(var r=0;r<e.tasks[n].volunteers.length;r++)if(e.tasks[n].volunteers[r].volunteer_ref._id===e.volunteer._id){e.tasks[n].volunteers[r].volunteer_ref.schedules=e.tasks[n].volunteers[r].volunteer_ref.schedules||[],e.tasks[n].volunteers[r].volunteer_ref.schedules.push(angular.copy(e.schedule)),e.schedule={},e.volunteer={},l.alert("Schedule added");break}break}}).error(function(e,t){u(e,t)})},e.deleteSchedule=function(t,n,r){a.deleteSchedule(n,r).success(function(o){for(var a=0;a<e.tasks.length;a++){if(e.tasks[a]._id===t)for(var s=-1,i=0;i<e.tasks[a].volunteers.length;i++)if(e.tasks[a].volunteers[i].volunteer_ref._id===n){for(var s=-1,u=0;u<e.tasks[a].volunteers[i].volunteer_ref.schedules.length;u++)if(e.tasks[a].volunteers[i].volunteer_ref.schedules[u]._id===r){s=u;break}s>-1&&(e.tasks[a].volunteers[i].volunteer_ref.schedules.splice(s,1),l.alert("Schedule deleted"));break}break}}).error(function(e,t){u(e,t)})},e.editSchedule=function(e,t,n){a.editSchedule(e,t,n).success(function(e){l.alert("Schedule modified.")}).error(function(e,t){u(e,t)})},e.selectedUserChange=function(t){e.newTask=angular.extend({},t)},e.querySearch=function(t){return t&&""!==t?(t=angular.lowercase(t),e.staff.filter(function(e){return 0===e.firstname.indexOf(t)||0===e.lastname.indexOf(t)||0===e.email.indexOf(t)})):e.staff},e.selectedUserChange=function(t){e.volunteer=angular.extend({},t)},e.querySearch=function(t){return t&&""!==t?(t=angular.lowercase(t),e.volunteers.filter(function(e){return 0===e.user_ref.firstname.indexOf(t)||0===e.user_ref.lastname.indexOf(t)||0===e.user_ref.email.indexOf(t)})):e.volunteers},e.searchLabel=function(){return e.volunteers.length?"Select volunteer to assign task":"No volunteer found"},e.isEventOwner=function(){return"owner"===e.role},e.isTaskManager=function(){return"manager"===e.role},e.isVolunteer=function(){return"volunteer"===e.role}}]),angular.module("eventApp").controller("eventViewCtrl",["$scope","$stateParams","$location","EventService","OrganizerService","$rootScope","$state","$sce","VolunteerService","$mdDialog","TaskService","$mdToast",function(e,t,n,r,o,a,s,i,l,u,c,d){function g(e,n,r){c.getAllTasks(t.event_id).then(function(t){t&&(e.tasks=t.data)}),e.volunteerForTask=function(e){l.volForTask(e),r.show(r.simple().content("You have successfully volunteered!").hideDelay(4e3).position("bottom right")),n.hide(),document.body.scrollTop=document.documentElement.scrollTop=0}}e.services=function(){r.getEvent(t.event_id).success(function(t){e.event=t.details,e.role=t.role,e.event.description=i.trustAsHtml(e.event.description),$(".md-warn").css("background-color",e.event.eventTheme.headerColor),$(".md-warn").css("color",e.event.eventTheme.fontColor),$(".values").css("border-color",e.event.eventTheme.borderColor),$(".values").css("background-color",e.event.eventTheme.contentColor),$(".values").css("color",e.event.eventTheme.fontColor),e.event.user_ref.organizer_ref&&o.getOrganizer(e.event.user_ref.organizer_ref).success(function(t){e.organizer=t,e.organizer.phoneNumber1=e.event.user_ref.phoneNumber1})})},a.hideBtn=!1,e.editEvent=function(){s.go("user.editEvent",{event_id:t.event_id}),document.body.scrollTop=document.documentElement.scrollTop=0},e.deleteEvent=function(){r.deleteEvent(t.event_id),n.url("/home")},e.publishEvent=function(){r.publishEvent(t.event_id).success(function(t){e.canPublish=!1})},e.showTasks=function(){u.show({clickOutsideToClose:!0,controller:g,locals:{view:"taskList"},templateUrl:"app/views/taskList.view.html"})},g.$inject=["$scope","$mdDialog","$mdToast"],e.manageTasks=function(){s.go("user.eventTasks",{event_id:t.event_id})},e.isEventOwner=function(){return"owner"===e.role},e.isTaskManager=function(){return"manager"===e.role},e.isVolunteer=function(){return"volunteer"===e.role},e.canPublish=function(){return"owner"===e.role&&!e.event.online},e.canManageTasks=function(){return"owner"===e.role&&e.event.user_ref.organizer_ref},e.viewTasks=function(){s.go("user.eventTasks",{event_id:t.event_id}),document.body.scrollTop=document.documentElement.scrollTop=0}}]),angular.module("eventApp").controller("homeCtrl",["$scope","$rootScope","$mdDialog","$mdToast","UserService","$location","$state","EventService",function(e,t,n,r,o,a,s,i){function l(e,t,n,r){function a(e){var t=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return t.test(e)}"signup"===r?e.signupDialog=!0:e.loginDialog=!0,e.closeDialog=function(){n.hide()},e.toggleDialog=function(){e.signupDialog=!e.signupDialog,e.loginDialog=!e.loginDialog},e.toggleView=function(){e.loginDialog=!e.loginDialog,e.resetDialog=!e.resetDialog},e.loginUser=function(r){e.wrongEmail=!1,e.wrongPassword=!1,o.authenticate(r).then(function(r){e.progressLoad=!0,"Authentication failed. User not found."===r.data.message?(e.wrongEmail=!0,e.wrongPassword=!1,e.progressLoad=!1):"Authentication failed. Wrong password."===r.data.message?(e.wrongEmail=!1,e.wrongPassword=!0,e.progressLoad=!1):(localStorage.setItem("userToken",r.data.token),t.signupCheck(),n.hide())})},e.signupUser=function(t){a(t.email)?(e.progressLoad=!0,o.createUser(t).then(function(n){n.data.message?(e.emailTaken=!0,e.progressLoad=!1,e.validEmail=!1):e.loginUser({email:t.email,password:t.password})})):(e.emailTaken=!1,e.validEmail=!0)},e.resetLink=function(t){o.sendLink(t).then(function(n){e.errorEmail=!1,e.progressBar=!0,"No user found"===n.data.message&&t?(e.errorEmail=!0,e.progressBar=!1):"Message Sent!"===n.data.message&&(e.emailSent=!0),e.progressBar=!1})}}$("a[href='#downpage']").click(function(){return $("html, body").animate({scrollTop:$("#event-list").offset().top},"slow"),!1}),t.hideBtn=!1;var u=a.search().token;a.search("token",null),u&&localStorage.setItem("userToken",u),t.signupCheck=function(){localStorage.getItem("userToken")&&o.decodeUser()},e.logout=function(){localStorage.removeItem("userToken"),t.loggedIn=!1,a.url("/home")},e.login=function(e){n.show({clickOutsideToClose:!0,controller:l,locals:{view:e},templateUrl:"app/views/login.view.html"})},e.toEvent=function(){e.loggedIn===!0&&a.path("/cevent")},e.fetchEvents=function(){i.getAllEvents().then(function(t){e.eventList=t.data})},l.$inject=["$scope","$rootScope","$mdDialog","view"],t.sendWelcomeMail=function(e){var t={mail:e.email,name:e.firstname};o.sendWelcomeMail(t).success(function(e,t,n,r){})},e.openEventDetails=function(e){s.go("user.eventDetails",{event_id:e}),document.body.scrollTop=document.documentElement.scrollTop=0}}]),angular.module("eventApp").controller("moreEventsCtrl",["$scope","$rootScope","EventService",function(e,t,n){e.fetchEvents=function(){n.getAllEvents().then(function(t){e.eventList=t.data})},e.categories="Technology,Sport,Health,Music,Art,Science,Spirituality,Media,Family,Education,Party".split(",").map(function(e){return{name:e}}),e.getCountryCode=function(){var e=document.getElementById("ddlViewBy"),t=e.options[e.selectedIndex].value,n=e.options[e.selectedIndex].text;return{code:t,text:n}},e.find={name:"",category:"",venue:{country:""}},e.countryCode="",e.$watch("countryCode",function(){return e.countryCode?void(e.find.venue.country=e.getCountryCode().text):void(e.find.venue.country="")}),t.hideBtn=!1}]),angular.module("eventApp").controller("profileCtrl",["$scope","$rootScope","EventService","OrganizerService","Upload","UserService","TaskService","$state","$window",function(e,t,n,r,o,a,s,i,l){function u(e){if(!e)return"";var t=new Date(Date.parse(e)),n=Number(t.getMonth())+1+"-"+t.getDate()+"-"+t.getFullYear();return n}function c(e,t){422===Number(t)||401===Number(t)||403===Number(t)?l.alert(e.message):l.alert("An error just occured, please try again!")}localStorage.getItem("userToken")?(t.hideBtn=!1,e.userEditMode=!1,e.organizerEditMode=!0,e.orgProfileExists=!1,e.staff=[],e.searchText="",e.users=[],e.newStaff={name:"",email:"",role:""},a.getCurrentUser().success(function(t){t.organizer_ref&&(e.organizer=t.organizer_ref,e.organizerEditMode=!1,e.orgProfileExists=!0),e.userInformation=t,t.profilePic||(e.userInformation.profilePic="../../assets/img/icons/default-avatar.png"),e.syncGenderDateDet()}).error(function(e,t){c(e,t)}),e.organizer&&r.getMyProfile().success(function(t){var n;e.staff=t.staff.map(function(e){return n={},n.id=e._id,n.managerId=e.manager_ref._id,n.firstname=e.manager_ref.firstname,n.lastname=e.manager_ref.lastname,n.email=e.manager_ref.email,n.role=e.role,n})}).error(function(e,t){c(e,t)}),a.getAllUsers().success(function(t){e.users=t.map(function(e){return e.firstname=angular.lowercase(e.firstname),e.lastname=angular.lowercase(e.lastname),e.email=angular.lowercase(e.email),e})}).error(function(e,t){c(e,t)}),n.getMyPublishedEvents().success(function(t){e.publishedEvents=t}).error(function(e,t){c(e,t)}),n.getMyEventDrafts().success(function(t){e.eventDrafts=t}).error(function(e,t){c(e,t)}),s.getAllUserTasks().success(function(t){e.eventTasks=t}).error(function(e,t){c(e,t)}),s.getVolunteeredTasks().success(function(t){e.volunteeredTasks=t}).error(function(e,t){c(e,t)})):$location.url("/home"),e.organizerButtnSave=function(){return e.organizer.name?void(e.orgProfileExists?e.editOrganizer():e.registerOrganizer()):void l.alert("Name field is mandatory!")},e.registerOrganizer=function(){r.createProfile(e.organizer).success(function(t){e.userInformation.organizer_ref=t._id,e.organizer=t,e.organizerEditMode=!1,e.orgProfileExists=!0}).error(function(e,t){c(e,t)})},e.addTeamMember=function(){r.addTeamMember(e.organizer._id,{manager_ref:e.newStaff._id,role:e.newStaff.role}).success(function(t){var n=angular.copy(e.newStaff);n.id=t._id,n.managerId=n._id,e.staff.push(n),e.newStaff={},l.alert("Team member added!")}).error(function(e,t){c(e,t)})},e.deleteTeamMember=function(t){r.deleteTeamMember(e.organizer._id,t).success(function(n){for(var r=-1,o=0;o<e.staff.length;o++)if(e.staff[o].id.toString()===t.toString()){r=o;break}-1!==r&&e.staff.splice(r,1),l.alert("Team member deleted!")}).error(function(e,t){c(e,t)})},e.editMemberRole=function(t,n){r.editMemberRole(e.organizer._id,t,{newRole:n}).success(function(e){l.alert("Role changed!")}).error(function(e,t){c(e,t)})},e.editOrganizer=function(){r.editProfile(e.organizer).success(function(t){e.organizer=t,e.organizerEditMode=!1}).error(function(e,t){c(e,t)})},e.deleteOrganizer=function(){r.deleteProfile().success(function(t){e.organizerEditMode=!0,e.orgProfileExists=!1,e.userInformation.organizer_ref=void 0,e.organizer={},e.organizer.newImage=void 0}).error(function(e,t){c(e,t)})},e.updateUser=function(){return e.userInformation.firstname&&e.userInformation.lastname&&e.userInformation.email?void a.editProfile(e.userInformation).success(function(t){localStorage.setItem("userToken",t.token),a.decodeUser(),e.userInformation=t.user,e.syncGenderDateDet(),e.userEditMode=!1}).error(function(e,t){c(e,t)}):void l.alert("Fill all mandatory fields!")},e.uploadPicture=function(){return e.userInformation.newImage?void a.uploadPicture({newImage:e.userInformation.newImage}).success(function(t){localStorage.setItem("userToken",t.token),a.decodeUser(),e.userInformation.profilePic=t.user.profilePic,e.userEditMode=!1}).error(function(e,t){c(e,t)}):void l.alert("Choose a photo to upload!")},e.previewImg=function(e,t){$(e).on("change",function(){var n=document.querySelector(t),r=document.querySelector(e).files[0],o=new FileReader;o.onloadend=function(){n.src=o.result},r?o.readAsDataURL(r):n.src=""})},e.switchUserEditMode=function(t){e.userEditMode=t,e.userInformation.newImage=void 0,t?e.tempUserProfile=angular.copy(e.userInformation):e.userInformation=angular.copy(e.tempUserProfile)},e.switchOrganizerEditMode=function(t){e.organizerEditMode=t,e.organizer.newImage=void 0,t?e.tempOrgProfile=angular.copy(e.organizer):e.organizer=angular.copy(e.tempOrgProfile)},e.syncGenderDateDet=function(){"m"===angular.lowercase(e.userInformation.gender)?e.userInformation.genderDet="Male":"f"===angular.lowercase(e.userInformation.gender)?e.userInformation.genderDet="Female":e.userInformation.genderDet=e.userInformation.gender,e.userInformation.dobDet=u(e.userInformation.dateOfBirth),1===e.userInformation.dobDet.indexOf("-")&&(e.userInformation.dobDet="0"+e.userInformation.dobDet),4===e.userInformation.dobDet.lastIndexOf("-")&&(e.userInformation.dobDet=e.userInformation.dobDet.substring(0,3)+"0"+e.userInformation.dobDet.substring(3))},e.editEvent=function(e){i.go("user.editEvent",{event_id:e}),document.body.scrollTop=document.documentElement.scrollTop=0},e.viewEvent=function(e){i.go("user.eventDetails",{event_id:e}),document.body.scrollTop=document.documentElement.scrollTop=0},e.deleteEvent=function(e,t){n.deleteEvent(e).success(function(){for(var n=0;n<t.length;n++)if(t[n]._id===e){t.splice(n,1);break}})},e.viewTasks=function(e){i.go("user.eventTasks",{event_id:e}),document.body.scrollTop=document.documentElement.scrollTop=0},e.selectedUserChange=function(t){e.newStaff=angular.extend({},t)},e.querySearch=function(t){return t&&""!==t?(t=angular.lowercase(t),e.users.filter(function(e){return 0===e.firstname.indexOf(t)||0===e.lastname.indexOf(t)||0===e.email.indexOf(t)})):e.users}}]),angular.module("eventApp").controller("resetPasswordCtrl",["$scope","UserService","$stateParams","$location","$timeout",function(e,t,n,r,o){e.token=n.token,e.savePassword=function(n,a){e.password1===e.password2?t.resetPassword(n,{password:a}).success(function(t){e.successMessage=!0,e.passwordMismatch=!1,e.passReset=!0,o(function(){r.url("/home")},3e3)}):e.password2&&e.password1&&(e.passwordMismatch=!0)}}]),angular.module("eventApp").controller("twitterCtrl",["$scope","UserService","$stateParams","$location","$timeout",function(e,t,n,r,o){e.sendWelcomeMail=function(e){var n={mail:e.email,name:""};t.sendWelcomeMail(n).success(function(e,t,n,r){})};var a=r.search().twitToken;r.search("twitToken",null),a&&localStorage.setItem("twitToken",a),e.completeUserCheck=function(){localStorage.getItem("twitToken")&&t.decodeTwitUser().then(function(t){e.userId=t.data._id})},e.changeMail=function(n){localStorage.getItem("twitToken")&&t.editTwitUser(e.userId,n).then(function(t){t.data.code?e.emailTaken=!0:(e.sendWelcomeMail({email:n.email}),localStorage.removeItem("twitToken"),r.url("/home?token="+t.data.token))})}}]),angular.module("eventApp").value("baseUrl","https://roots-event-manager.herokuapp.com/api/"),angular.module("eventApp").factory("EventService",["$http","$stateParams","$location","$rootScope","Upload","baseUrl",function(e,t,n,r,o,a){return{createEvent:function(e){var t=localStorage.getItem("userToken");return o.upload({method:"POST",url:"/api/event?token="+t,file:e.imageUrl,fields:e})},editEventDetails:function(e,t){var n=localStorage.getItem("userToken");return o.upload({method:"PUT",url:"/api/event/"+t+"?token="+n,file:e.newImageUrl,fields:e})},deleteEvent:function(t){var n=localStorage.getItem("userToken");return e["delete"]("/api/event/"+t+"?token="+n)},getAllEvents:function(){return e.get("/api/events")},getEvent:function(t){var n=localStorage.getItem("userToken");return e.get("/api/event/"+t+"?token="+n)},getMyPublishedEvents:function(){var t=localStorage.getItem("userToken");return e.get("/api/events/published?token="+t)},getMyEventDrafts:function(){var t=localStorage.getItem("userToken");return e.get("/api/events/saved?token="+t)},publishEvent:function(t){var n=localStorage.getItem("userToken");return e.put("/api/event/"+t+"/launch?token="+n)}}}]),angular.module("eventApp").factory("OrganizerService",["$http","Upload","baseUrl",function(e,t,n){return{createProfile:function(e){var n=localStorage.getItem("userToken");return t.upload({method:"POST",url:"/api/organizer?token="+n,file:e.newImage,fields:e})},editProfile:function(e){var n=localStorage.getItem("userToken");return t.upload({method:"PUT",url:"/api/organizer/"+e._id+"?token="+n,file:e.newImage,fields:e})},deleteProfile:function(){var t=localStorage.getItem("userToken");return e["delete"]("/api/organizer?token="+t)},getOrganizer:function(t){return e.get("/api/organizer/"+t)},getMyProfile:function(){var t=localStorage.getItem("userToken");return e.get("/api/organizer/?token="+t)},addTeamMember:function(t,n){var r=localStorage.getItem("userToken");return e.post("/api/organizer/"+t+"/team?token="+r,{manager:n})},deleteTeamMember:function(t,n){var r=localStorage.getItem("userToken");return e["delete"]("/api/organizer/"+t+"/team/"+n+"?token="+r)},editMemberRole:function(t,n,r){var o=localStorage.getItem("userToken");return e.put("/api/organizer/"+t+"/team/"+n+"?token="+o,r)}}}]),angular.module("eventApp").factory("TaskService",["$http","$rootScope",function(e,t){return{createTask:function(t,n){var r=localStorage.getItem("userToken");return e.post("/api/event/"+t+"/tasks?token="+r,n)},getAllTasks:function(t){var n=localStorage.getItem("userToken");return e.get("/api/event/"+t+"/tasks?token="+n)},getTask:function(t,n){var r=localStorage.getItem("userToken");return e.get("/api/event/"+t+"/task/"+n+"?token="+r)},editTask:function(t,n,r){var o=localStorage.getItem("userToken");return e.put("/api/event/"+t+"/task/"+n+"?token="+o,r)},deleteTask:function(t,n){var r=localStorage.getItem("userToken");return e["delete"]("/api/event/"+t+"/task/"+n+"?token="+r)},getAllUserTasks:function(){var t=localStorage.getItem("userToken");return e.get("/api/user/tasks?token="+t)},getVolunteeredTasks:function(){var t=localStorage.getItem("userToken");return e.get("/api/user/volunteers?token="+t)},getAllUserEventTasks:function(t){var n=localStorage.getItem("userToken");return e.get("/api/event/"+t+"/user/tasks?token="+n)},getAllMyEventVolunteers:function(t){var n=localStorage.getItem("userToken");return e.get("/api/event/"+t+"/user/volunteers?token="+n)},getEventPendingVolunteers:function(t){var n=localStorage.getItem("userToken");return e.get("/api/event/"+t+"/volunteers/pending?token="+n)},addVolunteerToTask:function(t,n){var r=localStorage.getItem("userToken");return e.post("/api/task/"+t+"/volunteers/"+n+"?token="+r)},removeVolunteerFromTask:function(t,n){var r=localStorage.getItem("userToken");return e["delete"]("/api/task/"+t+"/volunteers/"+n+"?token="+r)},addTaskSchedule:function(t,n,r){var o=localStorage.getItem("userToken");return e.post("/api/task/"+t+"/volunteers/"+n+"/schedules?token="+o,{schedule:r})},editSchedule:function(t,n,r){var o=localStorage.getItem("userToken");return e.put("/api/task/volunteers/"+t+"/schedules/"+n+"?token="+o,{schedule:r})},deleteSchedule:function(t,n){var r=localStorage.getItem("userToken");return e["delete"]("/api/task/volunteers/"+t+"/schedules/"+n+"?token="+r)}}}]),angular.module("eventApp").factory("UserService",["$http","$stateParams","$location","$rootScope","Upload","baseUrl",function(e,t,n,r,o,a){function s(e){var t=e.replace("-","+").replace("_","/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}return window.atob(t)}return{createUser:function(t){return e.post("/api/users",t)},getCurrentUser:function(){var t=localStorage.getItem("userToken");return e.get("/api/user?token="+t)},getAllUsers:function(){var t=localStorage.getItem("userToken");return e.get("/api/users?token="+t)},editProfile:function(t){var n=localStorage.getItem("userToken");return e.put("/api/user?token="+n,t)},uploadPicture:function(e){var t=localStorage.getItem("userToken");return o.upload({method:"POST",url:"/api/user/uploadpic?token="+t,file:e.newImage,fields:e})},authenticate:function(t){return e.post("/api/authenticate",t)},decodeUser:function(){if(localStorage.getItem("userToken")){var e=localStorage.getItem("userToken"),t={};if(e){var n=e.split(".")[1];t=JSON.parse(s(n)),r.userName=t.firstname,r.profilePic=t.profilePic||"../../assets/img/icons/default-avatar.png",r.userId=t._id,r.loggedIn=!0}}},decodeTwitUser:function(){var t=localStorage.getItem("twitToken");return e.get("/api/decode?token="+t)},editTwitUser:function(t,n){
return e.put("/api/twitterUser/"+t,n)},sendWelcomeMail:function(t){return e.post("/api/user/welcomeMail",t)},sendLink:function(t){return e.post("/api/forgotPass",t)},resetPassword:function(t,n){return e.post("/api/reset/"+t,n)}}}]),angular.module("eventApp").factory("VolunteerService",["$http","$rootScope",function(e,t){return{volForTask:function(t){var n=localStorage.getItem("userToken");return e.post("/api/task/"+t.id+"/volunteers?token="+n,t)},getAllVolsForTask:function(t){var n=localStorage.getItem("userToken");return e.get("/api/task/"+t+"/volunteers?token="+n)},addVolToTask:function(t,n){var r=localStorage.getItem("userToken");return e.post("/api/task/"+t+"/volunteers/"+n+"?token="+r)},removeVolFromTask:function(t,n){var r=localStorage.getItem("userToken");return e["delete"]("/api/task/"+t+"/volunteers/"+n+"?token="+r)},addSchedToVol:function(t,n,r){var o=localStorage.getItem("userToken");return e.post("/api/task/"+t+"/volunteers/"+n+"/schedules?token="+o,r)},editSchedule:function(t,n,r){var o=localStorage.getItem("userToken");return e.put("/api/task/volunteers/"+n+"/schedules/"+t+"?token="+o,r)},deleteSchedule:function(t,n){var r=localStorage.getItem("userToken");return e["delete"]("/api/task/volunteers/"+n+"/schedules/"+t+"?token="+r)},getEventVols:function(t){var n=localStorage.getItem("userToken");return e.get("/api/event/"+t+"/volunteers?token="+n)},getUserTaskSchedule:function(){var t=localStorage.getItem("userToken");return e.get("/api/user/volunteers?token="+t)},getVolTaskSchedule:function(t){var n=localStorage.getItem("userToken");return e.get("/api/tasks/volunteers/"+t+"?token="+n)},getEventVolsTaskSchedule:function(t){var n=localStorage.getItem("userToken");return e.get("/api/event/"+t+"/user/volunteers?token="+n)}}}]);